(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{Bboa:function(t,e,r){"use strict";r.d(e,"b",function(){return d}),r.d(e,"a",function(){return p});var o=r("gIcY"),i=r("BHnd"),n=(r("OlR4"),r("AytR")),a=r("p0Sj"),s=r("67Y/"),u=r("3y/w"),c=(r("UbLU"),r("BH1t"));function d(t){return function(e){return e.value&&!e.value[t]?{valid:!0}:null}}var p=function(){function t(t,e,r,i,n,a){this.commonService=t,this.snackBar=e,this.router=r,this.route=i,this.printerService=n,this.dialog=a,this.displayedColumns=["sno","productName","quantity","rate","tax","amount","action"],this.transaction_desc=[],this.sale_type=u.c,this.custFormMaxDate=new Date,this.form=new o.h({productName:new o.f("",[o.t.required,d("prod_name")]),quantity:new o.f("",o.t.required)}),this.custForm=new o.h({customerName:new o.f("",[o.t.required,d("customerName")]),curDate:new o.f(new Date,o.t.required)})}return t.prototype.ngOnInit=function(){this.loadProduct(),this.loadCustomers()},t.prototype.loadCustomers=function(){var t=this;this.commonService.getMethod(n.a.urls.getCustomer).subscribe(function(e){t.customerList=e,t._callCustomerFilter()})},t.prototype.loadProduct=function(){var t=this;this.commonService.getMethod(n.a.urls.getProduct).subscribe(function(e){t.productList=e,t._callFilter()})},t.prototype.displayFn=function(t){return t?t.prod_name:void 0},t.prototype.loadCustomerRateType=function(t){var e=this;this.commonService.getMethod(n.a.urls.getRateTypeByCustomer+"/"+t._id).subscribe(function(t){e.sale_type_arr=t})},t.prototype.displayCustomerFn=function(t){return t?t.customerName:void 0},t.prototype._callCustomerFilter=function(){var t=this;this.customerFilteredOptions=this.custForm.get("customerName").valueChanges.pipe(Object(a.a)(""),Object(s.a)(function(e){return e&&e.length>=1?t._custFilter(e):[]}))},t.prototype._callFilter=function(){var t=this;this.filteredOptions=this.form.get("productName").valueChanges.pipe(Object(a.a)(""),Object(s.a)(function(e){return e&&e.length>=1?t._filter(e):[]}))},t.prototype._filter=function(t){var e="string"==typeof t?t.toLowerCase():"";return this.productList.filter(function(t){return t.prod_name.toLowerCase().includes(e)})},t.prototype._custFilter=function(t){var e="string"==typeof t?t.toLowerCase():"";return this.customerList.filter(function(t){return t.customerName.toLowerCase().includes(e)})},t.prototype.onSubmit=function(){if(console.log("submit"),"VALID"==this.form.status){var t=this.form.value.productName;if(this.sale_type_arr){var e=this.sale_type_arr.filter(function(e){return e.prod_id==t._id})[0];e&&(this.sale_type=e.type)}var r=this.commonService.getProductPrice(t._id,this.sale_type);if(null==r)return this.snackBar.open("Rate not found for this product!!","Notice",{duration:1e3}),!1;this.transaction_desc.push({rate_type:this.sale_type,prod_name:t.prod_name,prod_id:t._id,product_id:t.product_id,prod_quan:this.form.value.quantity,prod_rate_per_unit:r.price,tax:r.tax?r.tax:0,prod_tax:r.tax?r.price*this.form.value.quantity*r.tax/100:0,sub_amount:r.price*this.form.value.quantity}),this.form.reset(),this.dataSource=new i.o(this.transaction_desc),this._callFilter(),this.prodField.nativeElement.focus()}},t.prototype._remove=function(t){this.transaction_desc.splice(t,1),this.dataSource=new i.o(this.transaction_desc)},t.prototype.getTotalCost=function(){return this.transaction_desc.map(function(t){return t.sub_amount}).reduce(function(t,e){return t+e},0)+this.transaction_desc.map(function(t){return t.prod_tax}).reduce(function(t,e){return t+e},0)},t.prototype._saveOrder=function(t){var e=this,r={customer_id:this.custForm.value.customerName._id,sale_date:this.custForm.value.curDate,total_amount:this.getTotalCost(),details:this.transaction_desc};this.transaction_desc=[],this.dataSource=new i.o(this.transaction_desc),this.commonService.postMethod(n.a.urls.postSales,r).subscribe(function(r){200==r.code?(e.snackBar.open("Saved successfully!!","Success",{duration:500}),e.lastSales={saleid:r.data.sale_id,saleamount:r.data.total_amount},"print"==t&&(e.printerService.printData={redirectUrl:"/transactions",format:"invoice",data:[r.data.sale_id],type:"SALES",date:new Date},e.router.navigate(["/layout",{outlets:{printpage:"printview"}}],{skipLocationChange:!0}))):e.snackBar.open("Error!!","Error",{duration:600})},function(t){e.snackBar.open(t,"Error",{duration:600})}),this.form.reset(),this.custForm=new o.h({customerName:new o.f("",o.t.required),curDate:new o.f(new Date,o.t.required)}),this._callCustomerFilter(),this._callFilter()},t.prototype.openSalesModal=function(t){this.dialog.open(c.a,{width:"500px",data:{saleid:t}}).afterClosed().subscribe(function(t){})},t}()}}]);